---
title: "title"
layout: post
categories: category
tags: [tag]
share: true
---

http://tutorialzine.com/2016/06/quick-tip-detecting-your-location-with-javascript/

JavaScript предоставляет простой, но мощный инструмент для определения местоположения устройств в виде [Geolocation API][1]. Данный объект представляет собой небольшой набор легких в использовании методов, с помощью которых можно определить расположение утсройтсва, используя для этого три вышеупомянутых механизма:

GPS - в первую очередь для мобильных устройтсв, точность отперделения местоположения до 10 метров
WiFi - доступен для большинтсва устройств, подключенных к Интернет, также очень точный сопосб
IP geolocation - ограниченный и часто ненадежный способ, наихудший вариант, используемый тогда, когда первые два споосбоа невозможны

Когда приложением запрашиваются данные о местоположении, браузер будет пытаться использовать все три способа в завиисмости от того, какой из них доступен в данный момент. Данные, полученные из WiFi являются более бытсрым способм, нежели GPS, и более точным, нежели IP geolocation.

## Использование Geolocation API

Geolocation API имеет почти 100:-ю кросс-браузерную поддержку, однако не мешает лишний раз убедиться в том, что этот интрумент доступен в текущем браузере. Для этого при помощи протого скипта выполняем проверку существоввания объекта `geolocation` в интерфейсе `Window.navigator`:

{% highlight javascript %}
if (navigator.geolocation) {
  // geolocation is available
}
else {
  // geolocation is not supported
}
{% endhighlight %}

Объект navigator.geolocation обладает тремя методами:

* Geolocation.getCurrentPosition() - возвращает текущее метоположение устройства
* Geolocation.watchPosition() - отслеживает зименение местоплолжения и запускает функцию-callback при возникновении события
* Geolocation.clearWatch() - удаляет event handler `watchPosition`

Методы getCurrentPosition() и watchPosition() используются примерно одинаковым способом. Оба метода работают асинхронно, пытаясь получить координаты местоположения устройства и в зависимости от положительного или отрицательного результата попытки вызввают или функцию-callback для обработки полученных результатов, или вызывают функцию-callback для вывода сообщения об ошибке:

{% highlight javascript %}
navigator.geolocation.getCurrentPosition (

    // функция обработки данных местоположения
    function (position) {

        // position - это объект, содержащий самую разнообразную информацию о местоположении запрашиваемого устройства

        position = {
            coords: {
                latitude - географическая широта, в десятичных градусах
                latitude - географическая долгота, в десятичных градусах
                altitude - высота над уровнем моря, в метрах
                accuracy - возможная погрешность в определении координат, в метрах
                altitudeAccuracy - возможная погрешность в определении высоты, в метрах
                heading - направление движения устройства в градусах, относительно направления на север
                speed - скорость движения устройства, метры в секунду
            }
            timestamp - время, когда были получены данные метораположения устройства
        }

    },

    // функция сообщения об ошибке получения данных
    function (error) {

        // error - это объект, который хранит в себе детальную информацию о полученной ошибке

        error = {
            code - здесь представляется код возвращаемой ошшибки
                    1 - PERMISSION_DENIED ( доступ запрещен )
                    2 - POSITION_UNAVAILABLE ( метоположение недоступно )
                    3 - TIMEOUT ( время ожидания истекло )

            message - детальная информация о возникшей ошибке в человекочитаемом формате
        }

    }
);
{% endhighlight %}

Как видно из кода выше, использование Geolocation API является простым способом. Достаочно выбрать и запустить необходимый метод, подождать, пока этот метод не вернет полученны екоординаты; затем обработать координаты нужным сопособм.

## Пользовательские разрешения

Так как Geolocation API требует получения достаточно конфиденциальных данных о пользователе



// FILE NAME
// year-month-day-name
2013-01-15-archlinux-slim.md

// CODE SNIPPET
{% highlight javascript %}
// ...
{% endhighlight %}

// INLINE LINK
[link]( "link title")

// ANNOUNCEED LINK
[text][1]

// INLINE IMAGE
![image title]({{site.url}}/images/uploads/2015/08/image.jpg "image alt")

***
[1]: https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/Using_geolocation "Geolocation API"
